/**
 * 点餐系统 v1.0
 * 最好用的扫码自助点餐系统！
 * 
 * http://diancan.work/
 * 
 * Copyright 2016, bliky
 * The vapp.site
 * http://vapp.site/
 * 
 * Released on: November 15, 2016
 */
function fastClick(){var e=$.fn.on;$.fn.on=function(){if(/click/.test(arguments[0])&&"function"==typeof arguments[1]&&supportTouch){var t,i=arguments[1];e.apply(this,["touchstart",function(e){t=e.changedTouches[0].clientY}]),e.apply(this,["touchend",function(e){Math.abs(e.changedTouches[0].clientY-t)>10||(e.preventDefault(),i.apply(this,[e]))}])}else e.apply(this,arguments);return this}}function onclick(e,t){if(supportTouch){var i;e.on("touchstart",function(e){i=e.changedTouches[0].clientY}),e.on("touchend",function(e){Math.abs(e.changedTouches[0].clientY-i)>10||(e.preventDefault(),t.call(this,e))})}else e.on("click",t)}function bind(e,t,i){var e=e||{},n=t?$(t):$("#app"),i=i||!1;for(var a in e)for(var o in e[a])!i&&"click"==o&&supportTouch?!function(t,i){var a;n.on("touchstart",t,function(e){a=e.changedTouches[0].clientY}),n.on("touchend",t,function(n){Math.abs(n.changedTouches[0].clientY-a)>10||(n.preventDefault(),e[t][i].call(this,n))})}(a,o):n.on(o,a,e[a][o])}function loadJs(e,t,i,n){if(e){var i=!!i,n=!!n,a=document.createElement("script"),o=document.getElementsByTagName("body")[0];a.type="text/javascript",a.src=e,i&&(a.async="async"),n&&(a.defer="defer"),t&&(a.onload=t),o.appendChild(a)}}var IM=function(e,t,i,n){if(!/^http(s*):\/\//.test(location.href))return void console.error("请在服务器环境运行IM.");var e=e||"ws://120.25.160.231:8282",a=new WebSocket(e);console.log(a),this.send=function(e){var e=e||"";"object"==typeof e&&(e=JSON.stringify(e)),a.send(e)},this.close=a.close,a.onopen=function(e){i&&i(e),a.onmessage=function(e){t&&t(e)},a.onclose=function(e){n&&n(e)}}},supportTouch=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),Toucher=function(e){var t=new Slider(e,(!0));t.slideEnd(300),this.slider=t;var i,n,a,o,r,s,d,l,c,u="input, select, textarea, button",v=[],p={startX:0,startY:0,currentX:0,currentY:0,diff:0},f={direction:"vertical",speed:300,freeMode:!0,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,touchRatio:1,touchAngle:45,resistance:!0,resistanceRatio:.85},h={velocity:0,swipeDirection:"",isHorizontal:function(){return"horizontal"===f.direction},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1,lteIE9:function(){var e=document.createElement("div");return e.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",1===e.getElementsByTagName("i").length}()}},m=function(e){if(e.originalEvent&&(e=e.originalEvent),l="touchstart"===e.type,l||!("which"in e)||3!==e.which){var t=p.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,r=p.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY;if(i=!0,n=!1,o=void 0,c=void 0,p.startX=t,p.startY=r,a=Date.now(),"touchstart"!==e.type){var s=!0;$(e.target).is(u)&&(s=!1),document.activeElement&&$(document.activeElement).is(u)&&document.activeElement.blur(),s&&e.preventDefault()}}},w=function(e){if(e.originalEvent&&(e=e.originalEvent),!l||"mousemove"!==e.type){if(l&&document.activeElement&&e.target===document.activeElement&&$(e.target).is(u))return void(n=!0);if(p.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,p.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof o){var m=180*Math.atan2(Math.abs(p.currentY-p.startY),Math.abs(p.currentX-p.startX))/Math.PI;o=h.isHorizontal()?m>f.touchAngle:90-m>f.touchAngle}if("undefined"==typeof c&&h.browser.ieTouch&&(p.currentX===p.startX&&p.currentY===p.startY||(c=!0)),i){if(o)return void(i=!1);if(c||!h.browser.ieTouch){e.preventDefault(),f.touchMoveStopPropagation&&!f.nested&&e.stopPropagation(),n||(s=t.getTranslate(),t.setWrapperTransition(0),d=!1),n=!0;var w=p.diff=h.isHorizontal()?p.currentX-p.startX:p.currentY-p.startY;w*=f.touchRatio,h.swipeDirection=w>0?"prev":"next",r=w+s,w<0&&r<t.maxTranslate()&&f.resistance&&(r=t.maxTranslate()+1-Math.pow(t.maxTranslate()-s-w,f.resistanceRatio)),f.freeMode&&(0===v.length&&v.push({position:p[h.isHorizontal()?"startX":"startY"],time:a}),v.push({position:p[h.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),t.setWrapperTranslate(r)}}}},g=function(e){if(e.originalEvent&&(e=e.originalEvent),i){Date.now();if(!i||!n||!h.swipeDirection||0===p.diff||r===s)return void(i=n=!1);i=n=!1;var a;if(a=f.followFinger?-t.translate:-r,f.freeMode){if(a<-20)return void t.slideTo(0,f.speed);if(a>-t.maxTranslate())return void t.slideEnd(f.speed);if(f.freeModeMomentum){if(v.length>1){var o=v.pop(),l=v.pop(),c=o.position-l.position,u=o.time-l.time;h.velocity=c/u,h.velocity=h.velocity/2,Math.abs(h.velocity)<f.freeModeMinimumVelocity&&(h.velocity=0),(u>150||(new window.Date).getTime()-o.time>300)&&(h.velocity=0)}else h.velocity=0;h.velocity=h.velocity*f.freeModeMomentumVelocityRatio,v.length=0;var m,w=1e3*f.freeModeMomentumRatio,g=h.velocity*w,b=t.translate+g,y=!1,_=20*Math.abs(h.velocity)*f.freeModeMomentumBounceRatio;if(b<t.maxTranslate()?f.freeModeMomentumBounce?(b+t.maxTranslate()<-_&&(b=t.maxTranslate()-_),m=t.maxTranslate(),y=!0,d=!0,console.log(1)):(b=t.maxTranslate(),console.log(2)):b>t.minTranslate()&&(f.freeModeMomentumBounce?(b-t.minTranslate()>_,m=t.minTranslate(),y=!0,d=!0,console.log(21),console.log("bounceAmount",_)):(b=t.minTranslate(),console.log(22))),0!==h.velocity)w=Math.abs((b-t.translate)/h.velocity);else if(f.freeModeSticky)return void t.slideTo(0,f.speed);f.freeModeMomentumBounce&&y?(console.log("params.freeModeMomentumBounce && doBounce",b),b>0&&(b=0),t.setWrapperTransition(w),t.setWrapperTranslate(b)):h.velocity&&(console.log("not params.freeModeMomentumBounce && doBounce",b),t.setWrapperTransition(w),t.setWrapperTranslate(b))}}}};this.attach=function(t){if(support.touch){var i=t?"removeEventListener":"addEventListener";e[i]("touchstart",m,!1),e[i]("touchmove",w,!1),e[i]("touchend",g,!1)}}},Slider=function(e,t){if(!e)return!1;var i=t?e.childNodes[0].offsetHeight:e.childNodes[0].offsetWidth,n=t?e.parentNode.offsetHeight:e.parentNode.offsetWidth;this.translate=0,this.minTranslate=function(){return i=i?i:t?e.childNodes[0].offsetHeight:e.childNodes[0].offsetWidth,-i},this.maxTranslate=function(){e.childNodes.length;i=i?i:t?e.childNodes[0].offsetHeight:e.childNodes[0].offsetWidth;var a=t?e.offsetHeight:e.offsetWidth,o=a-n;return o=o>0?o:0,-o},this.getTranslate=function(){var i,n,a,o;return a=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(n=a.transform||a.webkitTransform,n.split(",").length>6&&(n=n.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),o=new window.WebKitCSSMatrix("none"===n?"":n)):(o=a.MozTransform||a.OTransform||a.MsTransform||a.msTransform||a.transform||a.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=o.toString().split(",")),t||(n=window.WebKitCSSMatrix?o.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),t&&(n=window.WebKitCSSMatrix?o.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),n||0},this.transform=function(t){var i=e.style;return i.webkitTransform=i.MsTransform=i.msTransform=i.MozTransform=i.OTransform=i.transform=t,this},this.transition=function(t){"string"!=typeof t&&(t+="ms");var i=e.style;return i.webkitTransitionDuration=i.MsTransitionDuration=i.msTransitionDuration=i.MozTransitionDuration=i.OTransitionDuration=i.transitionDuration=t,this},this.setWrapperTransition=function(e){this.transition(e)},this.setWrapperTranslate=function(e){var i=0,n=0;t?n=e:i=e,this.translate=e,this.transform("translate("+i+"px, "+n+"px)")},this.slideTo=function(e,t){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),e<0&&(e=0);var n=-e*i;this.setWrapperTranslate(n),this.setWrapperTransition(t)},this.slideEnd=function(e){this.setWrapperTranslate(this.maxTranslate()),this.setWrapperTransition(e)}},support={touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),gestures:function(){return"ongesturestart"in window}()},device=function(){var e=navigator.userAgent,t=e.match(/(Android);?[\s\/]+([\d.]+)?/),i=e.match(/(iPad).*OS\s([\d_]+)/),n=e.match(/(iPod)(.*OS\s([\d_]+))?/),a=!i&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:i||a||n,android:t}}(),debug=function(e){var t="debug",i=$("#"+t);if(i.length>0)i.find("p").html(e);else{var n=['<div id="'+t+'" style="position:relative; z-index:5000; background-color:#000; color:#fff;">',"<p>"+e+"</p>","</div>"].join("");i=$(n).appendTo("body")}},Render=function(){function e(e,t){var t=t||{};for(key in t)if("undefined"==typeof e[key])e[key]=t[key];else if("object"==typeof e[key])for(var i in t[key])"undefined"==typeof e[key][i]&&(e[key][i]=t[key][i]);return e}this.main_view=function(e){return e.recipe?'<div class="view-avatar"><img src="'+e.avatar+'"></div><div class="view-text"><h1>'+e.name+'<span style="color:#09bb07;">&nbsp;￥'+e.price+"</span></h1><p>配料:"+e.recipe+"</p></div>":'<div class="view-avatar"><img src="'+e.avatar+'"></div><div class="view-text"><h1 style="font-size:20px; margin-top:8px;">'+e.name+'<span style="color:#09bb07;">&nbsp;￥'+e.price+"</span></h1></div>"},this.order_item=function(t){var t=t||{},i={user:{id:0,name:"",avatar:""},name:"null",avatar:"img/1_min.jpg",taste:"",price:0,mount:1,index:0};e(t,i);var n="";return(t.user.name||t.user.avatar)&&(n='<div class="top">',t.user.avatar&&(n+='<div class="left"><img src="'+t.user.avatar+'"></div>'),t.user.name&&(n+='<div class="right"><p>'+t.user.name+"</p></div>"),n+="</div>"),'<li data-index="'+t.index+'" data-uid="'+t.user.id+'" data-taste="'+t.tasteIndex+'">'+n+'<div class="bot"><div class="left"><img src="'+t.avatar+'"></div><div class="right"><p>'+t.name+"</p><p>"+t.taste+"</p><p>"+t.price+"元</p></div></div></li>"},this.picker_foods=function(e,t){function i(e){for(var i in t)if(e==t[i].id)return t[i].title;return!1}var n=e.length,a=[],o=[],r=0,s=e[0].cate;o.push({pindex:0,cate:s,title:i(s)}),a.push('<ul class="swiper-slide" data-cate="'+s+'">');for(var d=0;d<n;d++)(e[d].cate!=s||d>0&&d%10==0)&&(r++,e[d].cate!=s&&(s=e[d].cate,o.push({pindex:r,cate:s,title:i(s)})),a.push('</ul><ul class="swiper-slide" data-cate="'+s+'">')),a.push('<li data-index="'+d+'" data-cate="'+e[d].cate+'" data-id="'+e[d].id+'"><img src="'+e[d].avatar_min+'"><p>'+e[d].name+"</p></li>"),d>=n-1&&a.push("</ul>");return window._tapPickMap=o,a.join("")}},UI=function(){function e(e){e.show().addClass("slideIn"),e.one("animationend webkitAnimationEnd",function(){e.removeClass("slideIn")})}function t(e){e.addClass("slideOut"),e.one("animationend webkitAnimationEnd",function(){e.removeClass("slideOut").hide()})}this.actionsheet=function(e,t,i){var i=i||0,n='<div class="actionsheet">';i&&(n+='<div class="actionsheet-show"></div><div class="actionsheet-title"><div class="actionsheet-cell"></div></div>'),n+='<div class="actionsheet-menu"></div><div class="actionsheet-action"><div class="actionsheet-cell cancel">取消</div></div></div>',$newActsheet=$(n).appendTo(t);var a=$("#uiMask"),o=$newActsheet.children(".actionsheet-menu");o.on("click",".actionsheet-cell",e);var r={loadPre:function(e,t){var i=$newActsheet.children(".actionsheet-show"),n=$newActsheet.children(".actionsheet-title").children(".actionsheet-cell");return i.empty().append('<img src="'+e.avatar+'"><p><b>'+e.title+"</b><br>"+e.desc+"</p>"),n.html(t),this},load:function(e){o.empty();for(var t=0;t<e.length;t++)if(e[t]){var i='<div class="actionsheet-cell" data-index="'+t+'">'+e[t]+"</div>";$(i).appendTo(o)}return this},show:function(){return $newActsheet.addClass("actionsheet-toggle"),a.fadeIn(200),this},hide:function(){return $newActsheet.removeClass("actionsheet-toggle"),a.fadeOut(200),this}};return a.on("click",r.hide),$newActsheet.on("click",".cancel",r.hide),r},this.dialog=function(e,t){var i='<div class="dialog" style="display: none;"><div class="dialog-hd"><strong class="dialog-title">'+e.title+'</strong></div><div class="dialog-bd">'+e.desc+'</div><div class="dialog-ft"><a href="javascript:;" class="dialog-btn dialog-btn-default">取消</a><a href="javascript:;" class="dialog-btn dialog-btn-primary">确定</a></div></div>',n=$(i).appendTo(t),a=$("#uiMask"),o={show:function(){a.fadeIn(200),n.fadeIn(200)},hide:function(){n.fadeOut(200),a.fadeOut(200)}};return n.on("click",".dialog-btn-default",function(){o.hide()}),n.on("click",".dialog-btn-primary",function(){e.action(),o.hide()}),a.on("click",function(){o.hide()}),o};var i=1;this.toast=function(e,t){var e=e||"^^",t=t||1,n="";switch(t){case 1:n="weui-icon-success-no-circle";break;case 2:n="loading";break;default:n="weui-icon-success",t=1}var a="toast_"+t+"_"+i,o=$("#"+a);if(console.log(o),o.length>0)o.find(".toast").html('<i class="'+n+' icon-toast"></i><p class="toast-content">'+e+"</p>"),o.fadeIn(100);else{var r=['<div id="'+a+'">','<div class="mask-transparent"></div>','<div class="toast">','<i class="'+n+' icon-toast"></i>','<p class="toast-content">'+e+"</p>","</div></div>"].join("");o=$(r).appendTo("body").fadeIn(100)}return 2!=t&&setTimeout(function(){o.fadeOut(100)},2e3),o},this.preview=function(i,n,a){var n=n||1,a=a||1e3,o="preview_"+n,r=$("#"+o);if(r.length>0)e(r);else{var s=['<div id="preview_'+n+'" class="page" style="padding-bottom:40px; z-index:'+a+';">','<div style="padding: 20px;">','<h1 style="text-align:left;font-size: 20px;font-weight: 600;"></h1>','<p style="margin-top:5px;color:#888;text-align:left;font-size: 14px;"></p>',"</div>",'<div class="weui-form-preview">','<div class="weui-form-preview__hd">','<label class="weui-form-preview__label">付款金额</label>','<em class="weui-form-preview__value">¥80.60</em>',"</div>",'<div class="weui-form-preview__bd">','<div class="weui-form-preview__item">','<label class="weui-form-preview__label">酸菜鱼，微辣</label>','<span class="weui-form-preview__value">50.6.0元</span>',"</div>","</div>",'<div class="weui-form-preview__bd">','<div class="weui-form-preview__item">','<label class="weui-form-preview__label">小炒肉，中辣</label>','<span class="weui-form-preview__value">30.0元</span>',"</div>","</div>",'<div class="weui-form-preview__ft">','<a class="weui-form-preview__btn weui-form-preview__btn_default" href="javascript:">取消</a>','<button type="submit" class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:">买单</button>',"</div>","</div>",'<br><div class="weui-form-preview">','<div class="weui-form-preview__hd">','<label class="weui-form-preview__label">付款金额</label>','<em class="weui-form-preview__value">¥200.50</em>',"</div>",'<div class="weui-form-preview__bd">','<div class="weui-form-preview__item">','<label class="weui-form-preview__label">干锅肥肠，微辣</label>','<span class="weui-form-preview__value">68.50元</span>',"</div>","</div>",'<div class="weui-form-preview__bd">','<div class="weui-form-preview__item">','<label class="weui-form-preview__label">啤酒鸭，中辣</label>','<span class="weui-form-preview__value">32.0元</span>',"</div>","</div>",'<div class="weui-form-preview__bd">','<div class="weui-form-preview__item">','<label class="weui-form-preview__label">帝王蟹，超辣</label>','<span class="weui-form-preview__value">100.0元</span>',"</div>","</div>",'<div class="weui-form-preview__ft">','<a class="weui-form-preview__btn weui-form-preview__btn_default" href="javascript:">取消</a>','<button type="submit" class="weui-form-preview__btn weui-form-preview__btn_primary" href="javascript:">买单</button>',"</div>","</div>","<br>",'<div style="padding: 15px;"><a href="javascript:;" class="weui-btn weui-btn_plain-primary">全部买单</a>','<a href="javascript:;" class="weui-btn weui-btn_plain-default">返回</a></div>',"</div>"].join("");r=$(s).appendTo("body"),e(r)}return r.one("click","a",function(){t(r)}),r.one("click","button",function(){t(r)}),r}},Router=function(e,t){function i(e){var t={};for(var i in a)if(a[i].url==e){t=a[i];break}return t}var e=e||"app",n=document.getElementById(e),t=t||"page",a={},o=this,r=this;r.state=function(e,t){var e=e||"",t=t||{};return"string"==typeof e&&"object"==typeof t&&e&&t?(t.url&&(t.template||t.templateId)&&(a[e]=t),o):(console.error("parameter error."),o)},r.states=function(){return console.log("states:",a),o},r.go=function(e){var e=e||"";return"string"!=typeof e?(console.error("parameter error."),o):(location.hash=e?"#"+e:"#",o)},r.nav=function(e){var a=i(e),o="";if(o=a.templateId?document.getElementById(a.templateId).innerHTML:a.template){var r=document.createElement("div"),s=a.animate||"slideIn";if(r.classList.add(t),r.classList.add(s),r.style.opacity="0",r.addEventListener("animationend",function(){r.classList.remove(s),r.style.opacity="1.0"}),r.addEventListener("webkitAnimationEnd",function(){r.classList.remove(s),r.style.opacity="1.0"}),r.innerHTML=o,"page"==t)n.innerHTML="";else for(var d=0;d<n.children.length;d++)n.children[d].style?n.children[d].style.display="none":null;n.appendChild(r),a.controller&&a.controller(r)}},window.onhashchange=function(e){var t=0===location.hash.indexOf("#")?location.hash.substring(1):"";r.nav(t)},window.onpopstate=function(e){}},REST=function(){var e=[],t=this,i=function(e){this.url=e||"",this._id="";var t=this;return this.id=function(e){return this._id=e,t},this.get=function(e,i){var e=e||null,i=i||{};return $.get(this._id?this.url+"/"+this._id:this.url,i,function(t,i,n){e&&e(t,n.status)},"json"),t},this.post=function(e,i){var e=e||null,i=i||{};return $.post(this._id?this.url+"/"+this._id:this.url,i,function(t,i,n){e&&e(t,n.status)},"json"),t},this.put=function(e,i){var e=e||null,i=i||{};return $.put(this._id?this.url+"/"+this._id:this.url,i,function(t,i,n){e&&e(t,n.status)},"json"),t},this.delete=function(e,i){var e=e||null,i=i||{};return $.delete(this._id?this.url+"/"+this._id:this.url,i,function(t,i,n){e&&e(t,n.status)},"json"),t},this};t.url=function(e){return new i(e)},t.register=function(t){return t&&t.name?(e.push(t),new i(t.url)):(console.error("REST register failed."),!1)},t.name=function(t){for(var n=0;n<e.length;n++)if(e[n].name==t)return new i(e[n].url);return console.error("%s not registered.",t),!1},$.each(["put","delete"],function(e,t){$[t]=function(e,i,n,a){return $.isFunction(i)&&(a=a||n,n=i,i=void 0),$.ajax({url:e,type:t,dataType:a,data:i,success:n})}})},App=function(){var e=['<div style="display: -webkit-flex;display: flex;position:fixed; z-index:8000; top:0; bottom:0; left:0; right:0; background-color:#333; color:#fff;"><p style="margin:120px auto 0; text-align:center;">竖屏使用，体验更好^^!</p></div>'].join(""),t=$(e).hide().appendTo("body");window.addEventListener("orientationchange",function(e){180!=window.orientation&&0!=window.orientation||t.hide(),90!=window.orientation&&window.orientation!=-90||t.show()});var i=['<div class="viewer">','<div class="header"><div id="storeTableInfo" class="left"></div><div class="right" id="orderInfo">数量:<span class="number count">0</span>份|金额:<span class="number amount">0</span>元</div></div>','<div class="view-left">',"</div>",'<div class="view-right">','<div id="orderSlider" class="slider-container">',"<ul>",'<li class="empty"></li>',"</ul>","</div>","</div>","</div>",'<div class="operator">','<div class="operate-btn-group">','<div class="operate-btn gradient warn" id="showClearDialog">清空</div>','<div class="operate-btn gradient vice" id="sendOrder">下单</div>',"</div>",'<div class="pick-slider" id="pickSlider">','<div class="swiper-wrapper">',"</div>",'<div class="pager"><span></span><span></span></div>',"</div>",'<div id="tapSlider" class="swiper-container tap-slider">','<ul class="swiper-wrapper">',"</ul>","</div>","</div>",'<div id="uiMask" class="mask" style="opacity: 0; display:none;"></div>','<div id="uiMask2" class="mask-black" style="opacity: 0; display:none;"></div>'].join(""),n=function(e){function t(e){if("undefined"==typeof e&&(e=!0),e){if($("#orderSlider").siblings().length)return;var t='<div class="center"><p>'+GV.store.table.title+"桌还未点菜~</p></div>";$(t).insertAfter("#orderSlider")}else $("#orderSlider").siblings().length&&$("#orderSlider").siblings().remove()}function i(e,t){var i=$(".view-avatar").children("img");i.addClass("slideUp"),i.on("animationend webkitAnimationEnd",function(){i.removeClass("slideUp")}),a.pushList(e,t),r.slider.slideEnd(300)}!function(){var e=(GV.store.avatar?'<img src="'+GV.store.avatar+'">':"")+GV.store.name+":"+GV.store.table.title+"桌";$("#storeTableInfo").html(e)}();var n=0,a={count:0,amount:0,list:[],to2Decimal:function(e){var t=parseFloat(e);if(!isNaN(t))return t=Math.round(100*e)/100},pushList:function(e,t,i){var t=t||0,a=o.order_item({user:i||GV.user,name:e.name,avatar:e.avatar_min,price:e.price,taste:e.taste?e.taste[t]:"",mount:1,index:n,tasteIndex:t});$("#orderSlider ul").append(a),this.add(e.price)},initList:function(){function e(e){for(var t=0;t<GV.foods.length;t++){var i=GV.foods[t];if(e==i.id)return{food:i,index:t}}return!1}if(this.count=0,this.amount=0,!(GV.order&&GV.order.list&&GV.order.list.length))return void t();for(var i=GV.order.list,a=0;a<i.length;a++){var o=i[a].fid,r=i[a].taste,s=i[a].user,d=e(o);n=d.index,this.pushList(d.food,r,s)}},init:function(e){var e=e||!1,i=e?"slideDown":"slideUp",n=$("#orderInfo").find(".count"),a=$("#orderInfo").find(".amount");this.count?t(!1):t(),n.html(this.count).addClass(i),a.html(this.amount).addClass(i),n.one("animationend webkitAnimationEnd",function(){n.removeClass(i)}),a.one("animationend webkitAnimationEnd",function(){a.removeClass(i)})},add:function(e){this.count+=1,this.amount+=e,this.amount=this.to2Decimal(this.amount),this.init()},remove:function(e){this.count-=1,this.amount-=e,this.amount=this.to2Decimal(this.amount),this.init(!0)},removeAll:function(){this.count=0,this.amount=0,this.init(!0)}},o=new Render,r=new Toucher($("#orderSlider ul")[0]);r.attach();var s=new UI,d=s.actionsheet(function(){var e=$(this).data("index"),t=GV.foods[n];d.hide(),i(t,e)},e,!0),l=s.dialog({title:"确定要清空订单吗？",desc:"清空后不可复原哦~",action:function(){console.log("清空订单！"),$this=$("#orderSlider li:not(.empty)"),$this.addClass("active slideOut"),$this.one("animationend webkitAnimationEnd",function(){$this.removeClass("slideOut").remove(),r.slider.slideEnd(300),a.removeAll()})}},e),c=new REST;c.register({name:"food",url:GV.api.food}),c.register({name:"foodCate",url:GV.api.foodCate}),c.register({name:"order",url:GV.api.order});var u=[],v=void 0,p=void 0;c.name("foodCate").get(function(e,t){200==e.code&&e.data&&(GV.foodCate=e.data,c.name("food").get(function(e,t){if(200==e.code&&e.data){GV.foods=e.data,$("#pickSlider").children(".swiper-wrapper").append(o.picker_foods(GV.foods,GV.foodCate)),$(".view-left").append(o.main_view(GV.foods[0])),a.initList();var i=window._tapPickMap,n=$("#tapSlider").children();for(var r in i)u.push(i[r].pindex),n.append('<li class="swiper-slide" data-cate="'+i[r].cate+'">'+i[r].title+"</li>");n.children().eq(0).addClass("active"),console.log(_tapPickMap),console.log(u),p=new Swiper("#tapSlider",{freeMode:!0,slidesPerView:"auto",onTap:function(e){v.slideTo(u[e.clickedIndex])}}),$("#pickSlider").find("li").eq(0).addClass("active"),v=new Swiper("#pickSlider",{pagination:".pager",paginationClickable:!0,paginationBulletRender:function(e,t){return'<span class="'+t+'"></span>'},onSlideChangeEnd:function(e){var t=e.activeIndex,i=0;for(var n in u)if(u[n]==t){i=n;break}var a=$("#tapSlider li").eq(i);a.siblings().removeClass("active"),a.addClass("active")}})}},{sid:GV.store.id}))},{sid:GV.store.id});var f={li:{click:function(e){var t=$(this);t.parents(".swiper-wrapper").find("li").removeClass("active"),t.addClass("active"),n=t.data("index");var a=GV.foods[n];$(".view-left").empty(),$(".view-left").append(o.main_view(a)),a.taste&&a.taste[0]?d.loadPre({title:a.name+'<span style="color:#09bb07;">&nbsp;￥'+a.price+"</span>",desc:a.recipe?"配料:"+a.recipe:"",avatar:a.avatar},"喜欢什么口味？").load(a.taste).show():i(a)}}};bind(f,"#pickSlider",!0);var h={li:{click:function(e){var t=$(this);t.siblings().removeClass("active"),t.addClass("active")}}};bind(h,"#tapSlider");var m={li:{click:function(e){var t=$(this),i=t.data("index"),n=GV.foods[i];t.siblings().removeClass("active"),t.addClass("active"),t.addClass("slideOut"),t.one("animationend webkitAnimationEnd",function(){t.removeClass("slideOut").remove(),r.slider.slideEnd(300),a.remove(n.price)})}}};bind(m,"#orderSlider");var w=void 0,g={"#sendOrder":{click:function(e){w=s.toast("正在下单...",2),a.list=[],$("#orderSlider ul").children("li:not(.empty)").each(function(){var e=$(this),t=e.data("index"),i=e.data("taste"),n=e.data("uid"),o=GV.foods[t];a.list.push({fid:o.id,taste:i,uid:n})}),GV.order.id?c.name("order").put(function(e,t){console.log(t,e)},{data:{id:GV.order.id,list:a.list}}):c.name("order").post(function(e,t){console.log(t,e)},{data:{list:a.list}}),setTimeout(function(){w.hide()},500)}},"#showClearDialog":{click:l.show}};bind(g,".operator");var b={".view-avatar":{click:function(e){s.toast("大图预览")}}};bind(b,".viewer")},a=new Router;a.state("home",{url:"home",template:i,templateId:"",controller:n}).nav("home")};